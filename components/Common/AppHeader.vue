<template>
  <header
    :class="['header', { 'header--scrolled': scrolled, 'header--menu-open': isMenuOpen }]"
    ref="header"
  >
    <div class="header__container container">
      <div class="header__btn-choose">
        <AnimatedLink href="#" text="Выбрать квартиру" />
      </div>
      <div class="header__logo">
        <NuxtLink to="/" class="header__logo-link">
          <svg width="196" height="40" viewBox="0 0 196 40" fill="none">
            <path
              d="M102.831 15.8734H114.417V19.2811H110.498V39.7273H106.749V19.2811H102.831V15.8734ZM119.528 34.2408C119.528 35.1042 119.704 35.7118 120.057 36.064C120.409 36.4162 120.88 36.5922 121.471 36.5922C122.061 36.5922 122.533 36.4162 122.885 36.064C123.237 35.7118 123.413 35.1042 123.413 34.2408V21.3598C123.413 20.4965 123.237 19.8886 122.885 19.5367C122.533 19.1845 122.061 19.0086 121.471 19.0086C120.88 19.0086 120.409 19.1845 120.057 19.5367C119.704 19.8886 119.528 20.4965 119.528 21.3598V34.2408ZM115.78 21.5983C115.78 19.6673 116.268 18.1849 117.245 17.1513C118.222 16.1176 119.631 15.6007 121.471 15.6007C123.311 15.6007 124.719 16.1176 125.696 17.1513C126.673 18.1849 127.162 19.6673 127.162 21.5983V34.0024C127.162 35.9334 126.673 37.4158 125.696 38.4494C124.719 39.483 123.311 40 121.471 40C119.631 40 118.222 39.483 117.245 38.4494C116.268 37.4158 115.78 35.9334 115.78 34.0024V21.5983ZM134.454 30.2197L133.295 32.4007V39.7273H129.547V15.8734H133.295V26.2669L138.271 15.8734H141.951L136.737 26.5053L141.951 39.7273H138.1L134.454 30.2197ZM154.491 30.8332V34.0024C154.491 35.9334 154.02 37.4158 153.077 38.4494C152.134 39.483 150.743 40 148.903 40C147.063 40 145.671 39.483 144.728 38.4494C143.786 37.4158 143.314 35.9334 143.314 34.0024V21.5983C143.314 19.6673 143.786 18.1849 144.728 17.1513C145.671 16.1176 147.063 15.6007 148.903 15.6007C150.743 15.6007 152.134 16.1176 153.077 17.1513C154.02 18.1849 154.491 19.6673 154.491 21.5983V23.9156H150.948V21.3598C150.948 20.4965 150.771 19.8886 150.419 19.5367C150.067 19.1845 149.596 19.0086 149.005 19.0086C148.414 19.0086 147.943 19.1845 147.591 19.5367C147.239 19.8886 147.063 20.4965 147.063 21.3598V34.2408C147.063 35.1042 147.239 35.7062 147.591 36.047C147.943 36.3877 148.414 36.5582 149.005 36.5582C149.596 36.5582 150.067 36.3877 150.419 36.047C150.771 35.7062 150.948 35.1042 150.948 34.2408V30.8332H154.491ZM160.284 34.2408C160.284 35.1042 160.461 35.7118 160.813 36.064C161.165 36.4162 161.636 36.5922 162.227 36.5922C162.818 36.5922 163.289 36.4162 163.641 36.064C163.993 35.7118 164.169 35.1042 164.169 34.2408V21.3598C164.169 20.4965 163.993 19.8886 163.641 19.5367C163.289 19.1845 162.818 19.0086 162.227 19.0086C161.636 19.0086 161.165 19.1845 160.813 19.5367C160.461 19.8886 160.284 20.4965 160.284 21.3598V34.2408ZM156.536 21.5983C156.536 19.6673 157.025 18.1849 158.001 17.1513C158.978 16.1176 160.387 15.6007 162.227 15.6007C164.067 15.6007 165.476 16.1176 166.453 17.1513C167.429 18.1849 167.918 19.6673 167.918 21.5983V34.0024C167.918 35.9334 167.429 37.4158 166.453 38.4494C165.476 39.483 164.067 40 162.227 40C160.387 40 158.978 39.483 158.001 38.4494C157.025 37.4158 156.536 35.9334 156.536 34.0024V21.5983ZM175.96 15.8734C177.914 15.8734 179.328 16.3277 180.203 17.2365C181.077 18.1452 181.515 19.5197 181.515 21.3598V22.2117C181.515 23.4385 181.321 24.4494 180.935 25.2446C180.549 26.0396 179.936 26.6303 179.095 27.0165C180.118 27.4027 180.839 28.0332 181.259 28.9079C181.679 29.7824 181.889 30.8558 181.889 32.1282V34.0705C181.889 35.9107 181.412 37.3136 180.458 38.279C179.504 39.2446 178.084 39.7273 176.199 39.7273H170.303V15.8734H175.96ZM174.052 28.993V36.3197H176.199C176.835 36.3197 177.318 36.1493 177.647 35.8085C177.976 35.4677 178.141 34.8543 178.141 33.9684V31.8895C178.141 30.7763 177.954 30.0153 177.579 29.6064C177.204 29.1974 176.585 28.993 175.721 28.993H174.052ZM174.052 19.2811V25.5853H175.517C176.221 25.5853 176.772 25.4036 177.17 25.0402C177.567 24.6766 177.766 24.0177 177.766 23.0637V21.7347C177.766 20.8713 177.613 20.2467 177.306 19.8605C176.999 19.4743 176.517 19.2811 175.858 19.2811H174.052ZM187.512 34.2408C187.512 35.1042 187.688 35.7118 188.04 36.064C188.392 36.4162 188.864 36.5922 189.455 36.5922C190.045 36.5922 190.517 36.4162 190.869 36.064C191.221 35.7118 191.397 35.1042 191.397 34.2408V21.3598C191.397 20.4965 191.221 19.8886 190.869 19.5367C190.517 19.1845 190.045 19.0086 189.455 19.0086C188.864 19.0086 188.392 19.1845 188.04 19.5367C187.688 19.8886 187.512 20.4965 187.512 21.3598V34.2408ZM183.764 21.5983C183.764 19.6673 184.252 18.1849 185.229 17.1513C186.206 16.1176 187.614 15.6007 189.455 15.6007C191.295 15.6007 192.703 16.1176 193.68 17.1513C194.657 18.1849 195.145 19.6673 195.145 21.5983V34.0024C195.145 35.9334 194.657 37.4158 193.68 38.4494C192.703 39.483 191.295 40 189.455 40C187.614 40 186.206 39.483 185.229 38.4494C184.252 37.4158 183.764 35.9334 183.764 34.0024V21.5983Z"
              fill="#2C322C"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M0.693481 36.7175V39.7325H4.3647V36.1151L0.693481 36.7175ZM8.02699 39.7325H11.7069V17.748L8.02699 20.5059V39.7325ZM15.3784 14.7531V27.3728L19.0497 25.9994V12.1112L15.3784 14.7531ZM26.3511 39.7325L26.3917 3.0615L22.7129 -3.8147e-06V29.6297L15.3784 31.4112V39.7325H26.3511Z"
              fill="#2C322C"
            />
            <path
              d="M42.8989 15.8734C44.7846 15.8734 46.1874 16.3731 47.1074 17.3728C48.0276 18.3723 48.4875 19.8376 48.4875 21.7687V24.8696C48.4875 26.8007 48.0276 28.2661 47.1074 29.2657C46.1874 30.2652 44.7846 30.7651 42.8989 30.7651H41.1268V39.7273H37.3784V15.8734H42.8989ZM41.1268 19.2811V27.3573H42.8989C43.4895 27.3573 43.944 27.1983 44.262 26.8802C44.5801 26.5622 44.7391 25.9716 44.7391 25.1083V21.5302C44.7391 20.6669 44.5801 20.0763 44.262 19.7581C43.944 19.44 43.4895 19.2811 42.8989 19.2811H41.1268ZM53.6674 34.2408C53.6674 35.1042 53.8434 35.7118 54.1956 36.064C54.5477 36.4162 55.0191 36.5922 55.6097 36.5922C56.2004 36.5922 56.6719 36.4162 57.024 36.064C57.376 35.7118 57.5522 35.1042 57.5522 34.2408V21.3598C57.5522 20.4965 57.376 19.8886 57.024 19.5367C56.6719 19.1845 56.2004 19.0086 55.6097 19.0086C55.0191 19.0086 54.5477 19.1845 54.1956 19.5367C53.8434 19.8886 53.6674 20.4965 53.6674 21.3598V34.2408ZM49.9188 21.5983C49.9188 19.6673 50.4073 18.1849 51.3842 17.1513C52.3611 16.1176 53.7696 15.6007 55.6097 15.6007C57.4499 15.6007 58.8584 16.1176 59.8353 17.1513C60.8123 18.1849 61.3006 19.6673 61.3006 21.5983V34.0024C61.3006 35.9334 60.8123 37.4158 59.8353 38.4494C58.8584 39.483 57.4499 40 55.6097 40C53.7696 40 52.3611 39.483 51.3842 38.4494C50.4073 37.4158 49.9188 35.9334 49.9188 34.0024V21.5983ZM63.72 15.8734H67.4684V39.7273H63.72V15.8734ZM73.5344 22.4502V39.7273H70.1607V15.8734H74.8634L78.714 30.1517V15.8734H82.0537V39.7273H78.2029L73.5344 22.4502ZM83.7234 15.8734H95.3097V19.2811H91.3909V39.7273H87.6422V19.2811H83.7234V15.8734Z"
              fill="#2C322C"
            />
          </svg>
        </NuxtLink>
      </div>
      <div class="header__contacts">
        <div class="header__tel">
          <AnimatedLink
            href="tel:+3337767"
            text="333 77 67"
            customClass="header__tel-link"
            iconPosition="left"
          >
            <template #icon>
              <div class="header__tel--icon">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <g clip-path="url(#clip0_71_416)">
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M2.08531 1.04129C2.83727 0.291722 4.09807 0.501332 4.63042 1.38576L4.63415 1.39191L5.86129 3.48901C6.22265 4.11942 6.13149 4.92983 5.59237 5.46723L5.38883 5.67012C6.10948 6.80046 7.20428 7.91875 8.31086 8.58947L8.51316 8.41023C9.05232 7.88457 9.85709 7.79819 10.4842 8.15543L10.4888 8.15799L12.5654 9.36557C13.0795 9.61166 13.3501 10.0872 13.4055 10.562C13.4608 11.0364 13.309 11.5513 12.9398 11.9194L12.24 12.6169C11.5135 13.3411 10.3308 13.6616 9.32155 13.2043C7.99303 12.6614 6.00051 11.637 4.18456 9.82679C2.36387 8.01189 1.33757 5.96373 0.798366 4.7108C0.338373 3.70778 0.655353 2.53175 1.37681 1.80571L2.06916 1.05805C2.07443 1.05236 2.07981 1.04677 2.08531 1.04129ZM2.91633 1.85717L2.22637 2.60224C2.2211 2.60793 2.21572 2.61352 2.21022 2.61899C1.77346 3.05436 1.62815 3.72877 1.86084 4.23134C1.86309 4.2362 1.86526 4.24107 1.86737 4.24597C2.37859 5.43503 3.33451 7.33534 5.00924 9.00476C6.68694 10.6771 8.537 11.6284 9.77429 12.1329C9.78222 12.1361 9.79008 12.1396 9.79786 12.1431C10.3021 12.3751 10.9786 12.2302 11.4154 11.7949L12.1151 11.0973C12.2124 11.0004 12.2646 10.8468 12.2471 10.6963C12.2306 10.5554 12.1607 10.4589 12.0529 10.41C12.0349 10.4018 12.0174 10.3928 12.0004 10.3829L9.90379 9.16378C9.72008 9.06018 9.48449 9.08592 9.32439 9.24552C9.3163 9.25357 9.30801 9.26139 9.29946 9.26893L8.77465 9.73397C8.5939 9.89411 8.33276 9.92647 8.11821 9.81524C6.54488 8.99971 5.0097 7.40005 4.14645 5.86339C4.01885 5.63628 4.05825 5.35235 4.24289 5.16833L4.7677 4.6452C4.9278 4.4856 4.95362 4.25075 4.84971 4.06762L3.62886 1.98139C3.46268 1.70883 3.09903 1.68396 2.91633 1.85717Z"
                      fill="#2C322C"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M9.48223 4.51769C9.18975 4.22521 8.73798 4.12036 8.41851 4.22684C8.08608 4.33763 7.72679 4.15797 7.61599 3.82557C7.50516 3.49316 7.68483 3.13386 8.01725 3.02306C8.83979 2.74888 9.78374 3.0247 10.3795 3.62044C10.9752 4.21618 11.2511 5.16013 10.9768 5.98267C10.8661 6.31509 10.5068 6.49476 10.1743 6.38393C9.84192 6.27313 9.66229 5.91384 9.77308 5.58142C9.87956 5.26194 9.77472 4.81017 9.48223 4.51769Z"
                      fill="#2C322C"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M11.0539 2.94623C10.0189 1.91131 8.51457 1.54709 7.1666 1.91C6.84927 1.99543 6.5228 1.80745 6.43736 1.49012C6.35192 1.1728 6.53991 0.846303 6.85724 0.760868C8.60339 0.290746 10.5502 0.759558 11.8953 2.10474C13.2405 3.44991 13.7093 5.39669 13.2392 7.14284C13.1538 7.46017 12.8273 7.64816 12.51 7.56272C12.1926 7.47728 12.0047 7.15081 12.0901 6.83348C12.453 5.48551 12.0888 3.98113 11.0539 2.94623Z"
                      fill="#2C322C"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_71_416">
                      <rect width="14" height="14" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </div>
            </template>
          </AnimatedLink>
        </div>

        <div class="header__burger" @click="handleMenuToggle">
          <AnimatedLink
            :text="isMenuOpen ? 'Закрыть' : 'Меню'"
            customClass="header__burger--text"
            iconPosition="right"
          >
            <template #icon>
              <div class="header__burger--icon">
                <svg v-if="!isMenuOpen" width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M2.12887 1.33333C1.70149 1.33333 1.33341 1.70745 1.33341 2.11111V3.41988C1.33341 3.85011 1.67892 4.20831 2.15169 4.25H3.45461C3.882 4.25 4.25008 3.87589 4.25008 3.47222V2.11111C4.25008 1.67751 3.90553 1.33333 3.50765 1.33333H2.12887ZM0.166748 2.11111C0.166748 1.04897 1.0714 0.166668 2.12887 0.166668H3.50765C4.59464 0.166668 5.41675 1.0789 5.41675 2.11111V3.47222C5.41675 4.53436 4.51211 5.41667 3.45461 5.41667H2.12887C2.11518 5.41667 2.10149 5.4162 2.08784 5.41523C1.08507 5.34453 0.166748 4.55466 0.166748 3.41988V2.11111ZM8.54555 1.33333C8.11816 1.33333 7.75008 1.70745 7.75008 2.11111V3.47222C7.75008 3.87589 8.11816 4.25 8.54555 4.25H9.87127C10.2987 4.25 10.6667 3.87589 10.6667 3.47222V2.11111C10.6667 1.67751 10.3222 1.33333 9.92432 1.33333H8.54555ZM6.58341 2.11111C6.58341 1.04897 7.48805 0.166668 8.54555 0.166668H9.92432C11.0113 0.166668 11.8334 1.0789 11.8334 2.11111V3.47222C11.8334 4.53436 10.9288 5.41667 9.87127 5.41667H8.54555C7.48805 5.41667 6.58341 4.53436 6.58341 3.47222V2.11111ZM2.12887 7.75C1.70149 7.75 1.33341 8.12411 1.33341 8.52778V9.88889C1.33341 10.2543 1.66467 10.6239 2.15164 10.6667H3.45461C3.882 10.6667 4.25008 10.2926 4.25008 9.88889V8.52778C4.25008 8.09417 3.90553 7.75 3.50765 7.75H2.12887ZM0.166748 8.52778C0.166748 7.46565 1.0714 6.58333 2.12887 6.58333H3.50765C4.59464 6.58333 5.41675 7.49555 5.41675 8.52778V9.88889C5.41675 10.951 4.51211 11.8333 3.45461 11.8333H2.12887C2.11518 11.8333 2.10149 11.8329 2.08784 11.8319C1.09993 11.7622 0.166748 10.9847 0.166748 9.88889V8.52778ZM8.54555 7.75C8.11816 7.75 7.75008 8.12411 7.75008 8.52778V9.88889C7.75008 10.2926 8.11816 10.6667 8.54555 10.6667H9.87127C10.2987 10.6667 10.6667 10.2926 10.6667 9.88889V8.52778C10.6667 8.09417 10.3222 7.75 9.92432 7.75H8.54555ZM6.58341 8.52778C6.58341 7.46565 7.48805 6.58333 8.54555 6.58333H9.92432C11.0113 6.58333 11.8334 7.49555 11.8334 8.52778V9.88889C11.8334 10.951 10.9288 11.8333 9.87127 11.8333H8.54555C7.48805 11.8333 6.58341 10.951 6.58341 9.88889V8.52778Z"
                    fill="#2C322C"
                  />
                </svg>
                <svg v-else width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path
                    d="M14 0.824833L13.1752 0L7 6.17517L0.824833 0L0 0.824833L6.17517 7L0 13.1752L0.824833 14L7 7.82483L13.1752 14L14 13.1752L7.82483 7L14 0.824833Z"
                    fill="#F8F3ED"
                  />
                </svg>
              </div>
            </template>
          </AnimatedLink>
        </div>
      </div>
    </div>

    <Menu ref="menuComponent" :active-section="activeSection" @menu-closed="closeMenu" />
  </header>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import { useRouter } from 'vue-router';
import Menu from './Menu.vue';
import AnimatedLink from './AnimatedLink.vue';

const router = useRouter();

const props = defineProps({
  activeSection: {
    type: String,
    default: 'hero',
  },
});

const header = ref(null);
const scrolled = ref(false);
const menuComponent = ref(null);
const isMenuOpen = ref(false);

let isHandlingScroll = false;
const handleScroll = () => {
  if (isHandlingScroll) return;
  isHandlingScroll = true;

  requestAnimationFrame(() => {
    scrolled.value = typeof window !== 'undefined' ? window.scrollY > 50 : false;
    isHandlingScroll = false;
  });
};

const openMenu = () => {
  if (menuComponent.value) {
    isMenuOpen.value = true;
    menuComponent.value.openMenu();
  }
};

const closeMenu = () => {
  isMenuOpen.value = false;
};

const handleMenuToggle = () => {
  if (isMenuOpen.value) {
    // Закрываем меню
    if (menuComponent.value) {
      menuComponent.value.closeMenu();
    }
  } else {
    // Открываем меню
    openMenu();
  }
};

onMounted(() => {
  if (typeof window !== 'undefined') {
    window.addEventListener('scroll', handleScroll);
  }
});

onUnmounted(() => {
  if (typeof window !== 'undefined') {
    window.removeEventListener('scroll', handleScroll);
  }
});
</script>

<style lang="scss" scoped>
@use '@/assets/styles/variables.scss' as *;
.header {
  position: fixed;
  z-index: 12341 !important;
  width: 100%;
  transition: all 0.3s ease;

  @media (max-width: $breakpoint-x) {
    background-color: rgba(248, 243, 237, 0.95);
  }

  &__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-family: 'Akrobat';
    font-weight: 700;
    text-transform: uppercase;
    font-size: 20px;
    min-height: 45px;
    padding: 15px 20px 0;

    @media (max-width: $breakpoint-lg) {
      font-size: 18px;
    }

    @media (max-width: $breakpoint-x) {
      min-height: 60px;
      padding: 15px 20px 15px;
    }
  }

  &__btn-choose {
    position: relative;
    z-index: 9999;
    @media (max-width: $breakpoint-x) {
      display: none;
    }

    a {
      color: #2c322c;
      text-decoration: none;
      transition: color 0.3s ease;
      outline: none;
      border: none;
    }
  }

  &__contacts {
    display: flex;
    align-items: center;
    margin-left: 10px;
  }

  &__tel {
    position: relative;
    z-index: 9999;
    display: flex;
    align-items: center;

    @media (max-width: 375px) {
      display: none;
    }

    &--icon {
      margin-right: 6px;
    }

    &-link {
      display: flex;
      align-items: center;
      gap: 6px;
    }
  }

  &__burger {
    position: relative;
    z-index: 9999;
    cursor: pointer;
    margin-left: 20px;
    display: flex;
    align-items: center;
    min-width: 120px;
    justify-content: flex-end;

    @media (max-width: $breakpoint-x) {
      min-width: 80px;
    }

    &--text {
      min-width: 60px;
      text-align: right;
      display: flex;
      align-items: center;
      gap: 4px;
    }
  }
}

.header__logo {
  transform: translateX(35px);
  position: relative;
  z-index: 9999;
  transition:
    opacity 0.3s,
    transform 0.3s;

  &-link {
    display: inline-block;
    text-decoration: none;
    outline: none;
  }

  @media (max-width: $breakpoint-x) {
    transform: none;
  }

  svg {
    @media (max-width: $breakpoint-lg) {
      width: 155px;
    }

    @media (max-width: $breakpoint-x) {
      width: 135px;
      height: 28px;
    }
  }
}

.header--scrolled .header__logo {
  opacity: 0;
  transform: translateX(35px) translateY(-20px);
  pointer-events: none;

  @media (max-width: $breakpoint-x) {
    opacity: 1 !important;
    transform: translateY(0px) !important;
    pointer-events: auto !important;
  }
}

.header--menu-open .header__logo {
  opacity: 1 !important;
  pointer-events: auto !important;
  transform: translateX(35px) translateY(0) !important;

  @media (max-width: $breakpoint-x) {
    transform: translateX(0) translateY(0) !important;
  }
}

.header--menu-open {
  .header__btn-choose a {
    color: $text-color-light;
  }

  .header__tel {
    color: $text-color-light;
  }

  .header__tel--icon svg path {
    fill: $text-color-light;
  }

  .header__burger {
    color: $text-color-light;
  }

  .header__burger--icon svg path {
    fill: $text-color-light;
  }

  .header__logo svg path {
    fill: $text-color-light;
  }
}
</style>
